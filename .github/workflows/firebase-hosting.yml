name: Deploy Next.js Static Site to Firebase Hosting

on:
push:
branches:
- main

jobs:
build_and_deploy:
runs-on: ubuntu-latest
environment: production

steps:
  # 1. Checkout the repository code
  - name: Checkout Code
    uses: actions/checkout@v4

  # 2. Setup Node.js environment
  - name: Setup Node
    uses: actions/setup-node@v4
    with:
      node-version: 20
      cache: 'npm'

  # 3. Install dependencies and build the static site
  - name: Install and Build
    run: |
      npm ci
      npm run build
      
  # 4. Deploy to Firebase Hosting (This block starts around line 30, but
  #    the core issue is usually in the 'uses' or 'with' indentation)
  - name: Deploy to Firebase
    uses: FirebaseExtended/action-hosting-deploy@v0
    with:
      repoToken: '${{ secrets.GITHUB_TOKEN }}'
      firebaseServiceAccount: '${{ secrets.FIREBASE_SERVICE_ACCOUNT_PROJECT_ID }}'
      channelId: live
      projectId: 'next-js-site-ac1f6'
      
      # The public directory for Next.js static export is 'out'
      public: out
